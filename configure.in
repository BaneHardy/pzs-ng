dnl Process this file with autoconf to produce a configure script.

AC_INIT(zipscript/conf/zsconfig.h)
AC_CONFIG_HEADER(config.h)
AC_PREFIX_DEFAULT(/glftpd/)

dnl Checks for programs.
AC_PROG_CC
	
dnl Checks for libraries.
LCRYPT=""
if [[ $(uname -s) != "OpenBSD" ]]; then
	AC_CHECK_LIB(crypt, crypt, LCRYPT="-lcrypt", AC_MSG_ERROR([[Couldn't find libcrypt, quitting!]]))
fi

AC_CHECK_LIB(crypto, HMAC, LCRYPTO="-lcrypto", AC_MSG_ERROR([[Couldn't find libcrypto, quitting!]]))

dnl Checks for header files.
AC_HEADER_TIME
AC_HEADER_DIRENT
AC_HEADER_STDC
AC_CHECK_HEADERS(paths.h pwd.h regex.h fnmatch.h fcntl.h errno.h, , AC_MSG_ERROR([[Couldn't find required header, quitting!]]))
AC_CHECK_HEADERS(openssl/evp.h openssl/hmac.h openssl/sha.h, , AC_MSG_ERROR([[Couldn't find required header, quitting!]]))
AC_CHECK_HEADERS(sys/ipc.h sys/param.h sys/shm.h sys/time.h sys/uio.h sys/wait.h, , AC_MSG_ERROR([[Couldn't find required header, quitting!]]))

dnl Checks for typedefs, structures, and compiler characteristics.

dnl Checks for library functions.
dnl These two aren't used yet.

dnl Features

dnl OS :)

#os=unknown
#static=no
#case $(uname -s) in
#    [[Ll][Ii][Nn][Uu][Xx]])
#		os=linux
#		static=no
#        ;;
#	[oO][pP][eE][nN][bB][sS][dD])
#		LCRYPT=""
#		;;
#    [*[bB][sS][dD]*])
#		os=bsd
#		AC_MSG_RESULT([NOTICE: BSD flavour detected, linking statically.])
#		static=yes
#        ;;
#    [Ss][Uu][Nn][Oo][Ss])
#		os=sunos
#		static=no
#        ;;
#
#esac

#if test "$os" = "unknown" ; then
# AC_MSG_ERROR([Couldn't identify OS, quitting!])
#fi

#if test "$static" = "yes" ; then
# STATIC="-static"
#else
 AC_ARG_ENABLE(static, enable static linking of zs-c, STATIC="-static"; static=yes, STATIC="")
 if test "$static" = "yes" ; then
  AC_MSG_RESULT([NOTICE: linking statically (--enable-static).])
 else
  AC_MSG_RESULT([NOTICE: linking dynamically.])
 fi
#fi



AC_SUBST(STATIC)
AC_SUBST(LCRYPT)
AC_SUBST(LCRYPTO)

AC_OUTPUT(Makefile zipscript/src/Makefile sitebot/src/Makefile)
AC_MSG_RESULT(Now type 'make' to compile)
